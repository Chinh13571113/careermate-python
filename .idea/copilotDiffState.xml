<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/apps/recommendation_agent/services/job_query_service.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/apps/recommendation_agent/services/job_query_service.py" />
              <option name="originalContent" value="&quot;&quot;&quot;&#10;Job Query Service - Handles database queries for job postings&#10;&quot;&quot;&quot;&#10;from asgiref.sync import sync_to_async&#10;from apps.recommendation_agent.models import JobPostings&#10;&#10;&#10;def _query_all_jobs_sync():&#10;    &quot;&quot;&quot;&#10;    Get ACTIVE jobs from PostgreSQL (ORM)&#10;&#10;    Returns:&#10;        list: List of active job postings&#10;    &quot;&quot;&quot;&#10;    jobs = JobPostings.objects.filter(status=&quot;ACTIVE&quot;).values(&#10;        &quot;id&quot;, &quot;title&quot;, &quot;description&quot;, &quot;address&quot;&#10;    )&#10;&#10;    job_list = [&#10;        {&#10;            &quot;job_id&quot;: job[&quot;id&quot;],&#10;            &quot;title&quot;: job[&quot;title&quot;],&#10;            &quot;description&quot;: job[&quot;description&quot;],&#10;            &quot;address&quot;: job[&quot;address&quot;]&#10;        }&#10;        for job in jobs&#10;    ]&#10;    return job_list&#10;&#10;&#10;def query_all_jobs():&#10;    &quot;&quot;&quot;&#10;    Get active jobs (synchronous wrapper for backward compatibility)&#10;&#10;    Returns:&#10;        list: List of active job postings&#10;    &quot;&quot;&quot;&#10;    return _query_all_jobs_sync()&#10;&#10;&#10;async def query_all_jobs_async():&#10;    &quot;&quot;&quot;&#10;    Get active jobs (async wrapper)&#10;&#10;    Returns:&#10;        list: List of active job postings&#10;    &quot;&quot;&quot;&#10;    return await sync_to_async(_query_all_jobs_sync)()&#10;&#10;" />
              <option name="updatedContent" value="&quot;&quot;&quot;&#13;&#10;Job Query Service - Handles database queries for job postings&#13;&#10;&quot;&quot;&quot;&#13;&#10;from datetime import date&#13;&#10;from asgiref.sync import sync_to_async&#13;&#10;from apps.recommendation_agent.models import JobPostings&#13;&#10;&#13;&#10;&#13;&#10;def _query_all_jobs_sync():&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    Get ACTIVE and non-expired jobs from PostgreSQL (ORM)&#13;&#10;&#13;&#10;    Returns:&#13;&#10;        list: List of active job postings that haven't expired&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    today = date.today()&#13;&#10;    jobs = JobPostings.objects.filter(&#13;&#10;        status=&quot;ACTIVE&quot;,&#13;&#10;        expiration_date__gte=today&#13;&#10;    ).values(&#13;&#10;        &quot;id&quot;, &quot;title&quot;, &quot;description&quot;, &quot;address&quot;&#13;&#10;    )&#13;&#10;&#13;&#10;    job_list = [&#13;&#10;        {&#13;&#10;            &quot;job_id&quot;: job[&quot;id&quot;],&#13;&#10;            &quot;title&quot;: job[&quot;title&quot;],&#13;&#10;            &quot;description&quot;: job[&quot;description&quot;],&#13;&#10;            &quot;address&quot;: job[&quot;address&quot;]&#13;&#10;        }&#13;&#10;        for job in jobs&#13;&#10;    ]&#13;&#10;    return job_list&#13;&#10;&#13;&#10;&#13;&#10;def query_all_jobs():&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    Get active and non-expired jobs (synchronous wrapper for backward compatibility)&#13;&#10;&#13;&#10;    Returns:&#13;&#10;        list: List of active job postings that haven't expired&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    return _query_all_jobs_sync()&#13;&#10;&#13;&#10;&#13;&#10;async def query_all_jobs_async():&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    Get active and non-expired jobs (async wrapper)&#13;&#10;&#13;&#10;    Returns:&#13;&#10;        list: List of active job postings that haven't expired&#13;&#10;    &quot;&quot;&quot;&#13;&#10;    return await sync_to_async(_query_all_jobs_sync)()" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/apps/recommendation_agent/services/job_service.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/apps/recommendation_agent/services/job_service.py" />
              <option name="updatedContent" value="&quot;&quot;&quot;&#10;Job Indexing Service for syncing jobs to Weaviate&#10;&quot;&quot;&quot;&#10;import logging&#10;&#10;logger = logging.getLogger(__name__)&#10;&#10;&#10;class JobIndexingService:&#10;    &quot;&quot;&quot;Service for indexing jobs to Weaviate&quot;&quot;&quot;&#10;    &#10;    @staticmethod&#10;    def sync_single_job_to_weaviate(job_id):&#10;        &quot;&quot;&quot;&#10;        Sync a single job to Weaviate&#10;        &#10;        Args:&#10;            job_id: ID of the job to sync&#10;            &#10;        Returns:&#10;            bool: True if successful, False otherwise&#10;        &quot;&quot;&quot;&#10;        try:&#10;            from ..models import JobPostings, JobDescription&#10;            from .weaviate_service import index_job, delete_job&#10;            &#10;            # Get job from database&#10;            try:&#10;                job = JobPostings.objects.select_related('recruiter').prefetch_related(&#10;                    'jobdescription_set__jd_skill'&#10;                ).get(id=job_id)&#10;            except JobPostings.DoesNotExist:&#10;                logger.warning(f&quot;Job {job_id} not found in database&quot;)&#10;                return False&#10;            &#10;            # If job is not active, remove from Weaviate&#10;            if job.status != 'ACTIVE':&#10;                return delete_job(job_id)&#10;            &#10;            # Prepare job data for indexing&#10;            skills = [jd.jd_skill.name for jd in job.jobdescription_set.all()]&#10;            &#10;            job_data = {&#10;                'job_id': job.id,&#10;                'title': job.title,&#10;                'description': job.description or '',&#10;                'skills': skills,&#10;                'company_name': job.recruiter.company_name,&#10;                'address': job.address or '',&#10;            }&#10;            &#10;            # Index to Weaviate&#10;            return index_job(job_data)&#10;            &#10;        except Exception as e:&#10;            logger.error(f&quot;Error syncing job {job_id} to Weaviate: {str(e)}&quot;)&#10;            return False&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>